for: 
  var: vpc
  gvk: infra.yndd.io/v1alpha1/Vpc
vars:
  - var: nodes
    query: topo.yndd.io/v1alpha1/Node
    selector:
      matchLabels:
        yndd.io/topology: $infra.spec.topology
  - var: links
    query: topo.yndd.io/v1alpha1/Link
    selector:
      matchLabels:
        yndd.io/topology: $infra.spec.topology
        yndd.io/linktype: not infra
resources:
  - image: selectedNodeInterfaces # for bridges and routing tables, irb
    input: 
      - var: $nodes
      - var: $links
    output:
      - gvk: yndd.io/v1alpha1/Interfaces
        type: internal
      #- yndd.io/v1alpha1/NIAllocation: {type: internal} -> implicit, uses conditions
      #- yndd.io/v1alpha1/IPAllocation: {type: internal} -> implicit, uses conditions
  - image: generateConfig
    for:
      range: {gvk: yndd.io/v1alpha1/Interfaces}
      iterator2: interface
    input: 
      - var: $interface
      - var: $asAllocations
        query: yndd.io/v1alpha1/AsAllocation
        selector: {matchLabels: { yndd.io/nodeName: $nodeInfo.name}}
      - var: $ipAllocations
        query: yndd.io/v1alpha1/IPAllocation
        selector: {matchLabels: { yndd.io/nodeName: $nodeInfo.name}}  
      - var: $niAllocations
        query: yndd.io/v1alpha1/NIAllocation
        selector: {matchLabels: { yndd.io/nodeName: $nodeInfo.name}}
    output:
      - gvk: yndd.io/v1alpha1/Config
  - image: state
    config: stateInfo
    input: 
      - gvk: yndd.io/v1alpha1/Config
    output:
      - gvk: yndd.io/v1alpha1/State

services:
  - image: asInjection
  - image: ipInjection
  - image: niAllocation